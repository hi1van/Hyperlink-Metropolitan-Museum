<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/hypmet.png') }}">
    <title>Hyperlink Metropolitan Museum</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">

    <link rel="stylesheet" href="{{ url_for('static', filename='styles/browse.css') }}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
</head>
<body>
    <div class="page-container">

        <div class="columns">
            <div class="column is-narrow" style="margin-right: 30px; min-width: 100px; min-height: 100px;">
                <a class="logo" href="/index">
                    <img 
                        src="{{ url_for('static', filename='images/hypmethigh.png') }}" 
                        alt="Logo"
                        class="hover-image original"
                    >
                    <img 
                        src="{{ url_for('static', filename='images/hypmethighinvert.png') }}" 
                        alt="Logo Inverted"
                        class="hover-image inverted"
                    >
                </a>
            </div>
            <div class="column is-flex is-align-items-center">
                <a class="home" href="/index">
                    Home
                </a>
            </div>
        </div>


        <div class="columns">
            <div class="column">
                <h2 class="browse_title">Browse by Department</h2>
            </div>
        </div>

        <div class="columns is-multiline">
            {% for department in departments %}
            <div class="is-narrow">
                <button class="button is-unselected department-button" 
                        data-department="{{ department }}">
                        {{ department }}
                </button>
            </div>
            {% endfor %}
        </div>

        <div id="artwork-grid" class="columns is-multiline">

        </div>

        <div id="pagination-controls" class="columns">

        </div>
    </div>
</body>
<footer>
</footer>
</html>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const departmentButtons = document.querySelectorAll('.department-button');
    const artworkGrid = document.getElementById('artwork-grid');
    const paginationControls = document.getElementById('pagination-controls');

    // fetch and display artworks
    const loadArtworks = (department, page = 1) => {
        console.log("commence fetching artworks");
        fetch(`/api/departments/${department}/artworks?page=${page}`)
            .then(response => response.json())
            .then(data => {
                console.log(data);

                // clear the grid and pagination controls
                artworkGrid.innerHTML = '';
                
                // populate the artwork grid
                data.artworks.forEach(artwork => {
                    const artworkDiv = document.createElement('div');
                    artworkDiv.classList.add('column', 'is-narrow');
                    artworkDiv.innerHTML = `
                        <div class="frame">
                            <div class="frame-image">
                                <img src="${artwork.image}" alt="${artwork.title}">
                            </div>
                        </div>
                    `;
                    artworkGrid.appendChild(artworkDiv);
                });

                // add pagination controls
                const pagNav = document.createElement('div');
                pagNav.classList.add("column");

                if (page != 1) {
                    const first = document.createElement('button');
                    first.classList.add("button", "navigation");
                    first.textContent = "First";
                    first.addEventListener('click', () => loadArtworks(department, 1));
                    pagNav.appendChild(first);

                    const prev = document.createElement('button');
                    prev.classList.add("button", "navigation");
                    prev.textContent = "Previous";
                    prev.addEventListener('click', () => loadArtworks(department, page - 1));
                    pagNav.appendChild(prev);
                }

                if (page != data.total_pages) {
                    const next = document.createElement('button');
                    next.classList.add("button", "navigation");
                    next.textContent = "Next";
                    next.addEventListener('click', () => loadArtworks(department, page + 1));
                    pagNav.appendChild(next);

                    const last = document.createElement('button');
                    last.classList.add("button", "navigation");
                    last.textContent = "Last";
                    last.addEventListener('click', () => loadArtworks(department, data.total_pages));
                    pagNav.appendChild(last);
                }

                const currPage = document.createElement('div');
                currPage.classList.add("column");
                currPage.innerHTML = `
                    <h3 class="page-text">
                        Page ${page} of ${data.total_pages}
                    </h3>  
                    `;
                
                paginationControls.innerHTML = '';
                paginationControls.appendChild(pagNav);
                paginationControls.appendChild(currPage);


            })
            .catch(error => console.error('Error fetching artworks:', error));
    };

    // add click event to department buttons
    departmentButtons.forEach(button => {
        button.addEventListener('click', () => {
            const department = button.getAttribute('data-department');

            departmentButtons.forEach(btn => {
                btn.classList.remove("is-selected");
                btn.classList.add("is-unselected");
            });
            
            button.classList.remove("is-unselected");
            button.classList.add("is-selected");

            loadArtworks(department); // load artworks for the selected department
        });
    });
});



</script>